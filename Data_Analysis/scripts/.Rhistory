# SUMMARY
#   - H, df, p, epsilon².
#   - Strongest successive change with BH p and Cliff's delta.
#   - Per-gen Spearman with BH.
# ==============================================================================
stopifnot(exists("run_level"))
stopifnot("generation" %in% names(run_level), "energy_j_mean" %in% names(run_level))
acc_col <- dplyr::case_when(
"accuracy_mean" %in% names(run_level) ~ "accuracy_mean",
"accuracy" %in% names(run_level)      ~ "accuracy",
TRUE ~ NA_character_
)
if (is.na(acc_col)) stop("RQ3.3 requires 'accuracy_mean' or 'accuracy' in run_level.")
rq33 <- run_level %>%
mutate(
generation   = factor(generation, levels = c("2","3","3.1","3.2"), ordered = TRUE),
accuracy_val = suppressWarnings(as.numeric(.data[[acc_col]])),
accuracy_val = ifelse(!is.na(accuracy_val) & accuracy_val > 1, accuracy_val/100, accuracy_val)
) %>%
select(generation, energy_j_mean, accuracy_val) %>%
drop_na(accuracy_val, energy_j_mean)
# ---------- 1) Descriptives ----------
cat("\n--- RQ3.3 Descriptives (accuracy by generation) ---\n")
desc <- rq33 %>%
group_by(generation) %>%
summarise(
n_runs           = n(),
mean_accuracy    = mean(accuracy_val),
median_accuracy  = median(accuracy_val),
sd_accuracy      = sd(accuracy_val),
min_accuracy     = min(accuracy_val),
max_accuracy     = max(accuracy_val),
rho_E_acc        = suppressWarnings(cor(energy_j_mean, accuracy_val, method = "spearman",
use = "complete.obs")),
.groups = "drop"
) %>% arrange(generation)
print(desc, n = Inf)
readr::write_csv(desc, "tables/Statistical_Tests/RQ3.3/RQ33_descriptives.csv")
# ---------- 2) Omnibus: Kruskal–Wallis on accuracy ----------
cat("\n--- Kruskal–Wallis: accuracy ~ generation ---\n")
kw <- kruskal.test(accuracy_val ~ generation, data = rq33)
print(kw)
H <- as.numeric(kw$statistic)
k <- nlevels(rq33$generation)
n <- nrow(rq33)
eps2 <- (H - k + 1) / (n - k)
omnibus_csv <- tibble(
term     = "generation",
H_stat   = H,
df       = k - 1,
p_value  = kw$p.value,
epsilon2 = eps2,
note     = "Kruskal–Wallis on accuracy (run-level)"
)
readr::write_csv(omnibus_csv, "tables/Statistical_Tests/RQ3.3/RQ33_omnibus_kw.csv")
cat(sprintf("Epsilon-squared (omnibus): %.3f\n", eps2))
# ---------- 3) Post-hoc: successive Wilcoxon (BH) ----------
gens  <- levels(rq33$generation)
pairs <- tibble(g1 = gens[-length(gens)], g2 = gens[-1])
one_step <- function(g1, g2) {
sub <- rq33 %>%
filter(generation %in% c(g1, g2)) %>%
mutate(generation = droplevels(generation))
wt <- wilcox.test(accuracy_val ~ generation, data = sub, exact = FALSE)
x <- sub$accuracy_val[sub$generation == g1]  # older
y <- sub$accuracy_val[sub$generation == g2]  # newer
nx <- length(x); ny <- length(y)
m  <- outer(y, x, "-")
delta_newer <- (sum(m > 0) - sum(m < 0)) / (nx * ny)  # >0 = newer higher accuracy
tibble(
contrast      = paste(g2, "-", g1),
W             = unname(wt$statistic),
p_raw         = wt$p.value,
cliffs_delta  = delta_newer
)
}
wtab <- purrr::map2_dfr(pairs$g1, pairs$g2, one_step) %>%
mutate(
p_BH = p.adjust(p_raw, method = "BH"),
direction_note = "Cliff's delta > 0 means newer gen has higher accuracy (better)"
)
cat("\n--- Successive Wilcoxon tests on accuracy (BH across 3 steps) ---\n")
print(wtab, n = Inf)
readr::write_csv(wtab, "tables/Statistical_Tests/RQ3.3/RQ33_wilcoxon_consec.csv")
# ---------- 4) Spearman: accuracy vs energy within generation (BH) ----------
spearman_by_gen <- rq33 %>%
group_by(generation) %>%
group_modify(~{
ct <- suppressWarnings(cor.test(.x$accuracy_val, .x$energy_j_mean, method = "spearman"))
tibble(rho = unname(ct$estimate), p = ct$p.value)
}) %>%
ungroup() %>%
mutate(p_BH = p.adjust(p, method = "BH"))
cat("\n--- Spearman correlation: accuracy vs energy, within generation (BH) ---\n")
print(spearman_by_gen, n = Inf)
readr::write_csv(spearman_by_gen, "tables/Statistical_Tests/RQ3.3/RQ33_spearman_accuracy_energy.csv")
# ---------- 5) Plots ----------
# 5a) Box + jitter of accuracy by generation
p_box <- ggplot(rq33, aes(generation, accuracy_val, fill = generation)) +
geom_boxplot(outlier.alpha = 0.25, width = 0.65) +
geom_jitter(width = 0.08, height = 0, alpha = 0.55, size = 1) +
labs(x = "Generation", y = "Accuracy", fill = "Generation") +
theme_minimal()
ggsave("plots/Statistical_Tests/RQ3.3/RQ33_box_accuracy_by_generation.png", p_box,
width = 8, height = 5, dpi = 150, bg = "white")
# 5b) Scatter: accuracy vs energy, colored by generation
p_scatter <- ggplot(rq33, aes(accuracy_val, energy_j_mean, color = generation)) +
geom_point(alpha = 0.8, size = 2) +
labs(x = "Accuracy", y = "Energy per run (J)", color = "Generation") +
theme_minimal()
ggsave("plots/Statistical_Tests/RQ3.3/RQ33_scatter_accuracy_vs_energy.png", p_scatter,
width = 8, height = 5, dpi = 150, bg = "white")
cat("\nSaved plots:\n- plots/Statistical_Tests/RQ3.3/RQ33_box_accuracy_by_generation.png\n- plots/Statistical_Tests/RQ3.3/RQ33_scatter_accuracy_vs_energy.png\n")
# ---------- 6) One-paragraph console summary ----------
cat("\n=== RQ3.3 Summary ===\n")
cat(sprintf("Kruskal–Wallis on accuracy: H = %.3f, df = %d, p = %.4g; epsilon² = %.3f.\n",
H, k - 1, kw$p.value, eps2))
best <- wtab[order(wtab$p_BH), ][1, ]
cat(sprintf("Strongest successive change in accuracy: %s, Wilcoxon p(BH) = %.3g, Cliff's delta (newer−older) = %.2f.\n",
best$contrast, best$p_BH, best$cliffs_delta))
cat("Spearman accuracy–energy by gen (BH):\n"); print(spearman_by_gen, n = Inf)
# ==============================================================================
# RQ 3.2 — Inference duration and energy consumption
#
# DESIGN
#   • Unit of analysis: RUN (already averaged over repetitions).
#   • DV: average power per run (W) = energy_j_mean / duration_s_mean.
#   • Factor: generation (ordered: 2, 3, 3.1, 3.2). Size ignored here.
#
# TESTS (nonparametric ONLY; you said assumptions failed)
#   1) Omnibus: Kruskal–Wallis on power_w_run ~ generation.
#      - Effect size: epsilon² = (H − k + 1) / (n − k).
#   2) Planned post-hoc (successive, BH-adjusted): Wilcoxon rank-sum for
#      (2→3), (3→3.1), (3.1→3.2).
#      - Effect size: Cliff’s delta, signed so that
#        delta > 0 means the NEWER generation (g2) tends to have HIGHER power (worse).
#   3) Correlation check (secondary): Spearman ρ between duration and energy within
#      each generation; BH-adjusted across gens.
#
# OUTPUT FILES
#   tables/RQ32_descriptives.csv
#     generation, n_runs, mean/median/sd of duration, energy, power
#   tables/RQ32_omnibus_kw.csv
#     term, H_stat, df, p_value, epsilon2, note
#   tables/RQ32_wilcoxon_consec.csv
#     contrast, W, p_raw, p_BH, cliffs_delta, direction_note
#   tables/RQ32_spearman_duration_energy.csv
#     generation, rho, p, p_BH
#
# PLOTS
#   plots/RQ32_box_power_by_generation.png         (box + jitter of power)
#   plots/RQ32_scatter_duration_vs_energy.png      (duration vs energy, by gen)
#
# CONSOLE SUMMARY
#   - H, df, p, epsilon².
#   - Strongest successive change with BH p and Cliff’s delta.
#   - Per-gen Spearman with BH.
# ==============================================================================
suppressPackageStartupMessages({
library(tidyverse)  # dplyr, ggplot2, purrr, readr
library(ggplot2)
})
# ---------- 0) Data slice and derived power ----------
stopifnot(all(c("generation","energy_j_mean","duration_s_mean") %in% names(run_level)))
dir.create("tables", showWarnings = FALSE, recursive = TRUE)
dir.create("plots",  showWarnings = FALSE, recursive = TRUE)
rq32 <- run_level %>%
mutate(
power_w_run = if (!"power_w_run" %in% names(.))
energy_j_mean / pmax(duration_s_mean, 1e-9) else power_w_run,
generation  = factor(generation, levels = c("2","3","3.1","3.2"), ordered = TRUE)
) %>%
select(generation, energy_j_mean, duration_s_mean, power_w_run) %>%
drop_na(power_w_run, energy_j_mean, duration_s_mean)
# ---------- 1) Descriptives ----------
cat("\n--- RQ3.2 Descriptives (by generation) ---\n")
desc <- rq32 %>%
group_by(generation) %>%
summarise(
n_runs            = n(),
mean_duration_s   = mean(duration_s_mean),
median_duration_s = median(duration_s_mean),
sd_duration_s     = sd(duration_s_mean),
mean_energy_J     = mean(energy_j_mean),
median_energy_J   = median(energy_j_mean),
sd_energy_J       = sd(energy_j_mean),
mean_power_W      = mean(power_w_run),
median_power_W    = median(power_w_run),
sd_power_W        = sd(power_w_run),
.groups = "drop"
) %>% arrange(generation)
print(desc, n = Inf)
readr::write_csv(desc, "tables/RQ32_descriptives.csv")
# ---------- 2) Omnibus: Kruskal–Wallis on power ----------
cat("\n--- Kruskal–Wallis: power_w_run ~ generation ---\n")
kw <- kruskal.test(power_w_run ~ generation, data = rq32)
print(kw)
H <- as.numeric(kw$statistic)
k <- nlevels(rq32$generation)
n <- nrow(rq32)
eps2 <- (H - k + 1) / (n - k)
omnibus_csv <- tibble(
term     = "generation",
H_stat   = H,
df       = k - 1,
p_value  = kw$p.value,
epsilon2 = eps2,
note     = "Kruskal–Wallis on average power (run-level)"
)
readr::write_csv(omnibus_csv, "tables/RQ32_omnibus_kw.csv")
cat(sprintf("Epsilon-squared (omnibus): %.3f\n", eps2))
# ---------- 3) Post-hoc: successive Wilcoxon (BH) ----------
gens  <- levels(rq32$generation)
pairs <- tibble(g1 = gens[-length(gens)], g2 = gens[-1])
one_step <- function(g1, g2) {
sub <- rq32 %>%
filter(generation %in% c(g1, g2)) %>%
mutate(generation = droplevels(generation))
wt <- wilcox.test(power_w_run ~ generation, data = sub, exact = FALSE)
x <- sub$power_w_run[sub$generation == g1]  # older
y <- sub$power_w_run[sub$generation == g2]  # newer
nx <- length(x); ny <- length(y)
m  <- outer(y, x, "-")
delta_newer <- (sum(m > 0) - sum(m < 0)) / (nx * ny)  # >0 = newer higher power
tibble(
contrast      = paste(g2, "-", g1),
W             = unname(wt$statistic),
p_raw         = wt$p.value,
cliffs_delta  = delta_newer
)
}
wtab <- purrr::map2_dfr(pairs$g1, pairs$g2, one_step) %>%
mutate(
p_BH = p.adjust(p_raw, method = "BH"),
direction_note = "Cliff's delta > 0 means newer gen has higher power (worse)"
)
cat("\n--- Successive Wilcoxon tests on power (BH across 3 steps) ---\n")
print(wtab, n = Inf)
readr::write_csv(wtab, "tables/RQ32_wilcoxon_consec.csv")
# ---------- 4) Spearman: duration vs energy within generation (BH) ----------
spearman_by_gen <- rq32 %>%
group_by(generation) %>%
group_modify(~{
ct <- suppressWarnings(cor.test(.x$duration_s_mean, .x$energy_j_mean,
method = "spearman"))
tibble(rho = unname(ct$estimate), p = ct$p.value)
}) %>%
ungroup() %>%
mutate(p_BH = p.adjust(p, method = "BH"))
cat("\n--- Spearman correlation: duration vs energy, within generation (BH) ---\n")
print(spearman_by_gen, n = Inf)
readr::write_csv(spearman_by_gen, "tables/RQ32_spearman_duration_energy.csv")
# ---------- 5) Plots ----------
# 5a) Box + jitter of average power by generation
p_box <- ggplot(rq32, aes(generation, power_w_run, fill = generation)) +
geom_boxplot(outlier.alpha = 0.25, width = 0.65) +
geom_jitter(width = 0.08, height = 0, alpha = 0.55, size = 1) +
labs(x = "Generation", y = "Average power per run (W)", fill = "Generation") +
theme_minimal()
ggsave("plots/RQ32_box_power_by_generation.png", p_box,
width = 8, height = 5, dpi = 150, bg = "white")
# 5b) Scatter: duration vs energy, colored by generation
p_scatter <- ggplot(rq32, aes(duration_s_mean, energy_j_mean, color = generation)) +
geom_point(alpha = 0.8, size = 2) +
labs(x = "Inference duration (s)", y = "Energy per run (J)", color = "Generation") +
theme_minimal()
ggsave("plots/RQ32_scatter_duration_vs_energy.png", p_scatter,
width = 8, height = 5, dpi = 150, bg = "white")
cat("\nSaved plots:\n- plots/RQ32_box_power_by_generation.png\n- plots/RQ32_scatter_duration_vs_energy.png\n")
# ---------- 6) One-paragraph console summary ----------
cat("\n=== RQ3.2 Summary ===\n")
cat(sprintf("Kruskal–Wallis on power: H = %.3f, df = %d, p = %.4g; epsilon² = %.3f.\n",
H, k - 1, kw$p.value, eps2))
best <- wtab[order(wtab$p_BH), ][1, ]
cat(sprintf("Strongest successive change in power: %s, Wilcoxon p(BH) = %.3g, Cliff's delta (newer−older) = %.2f.\n",
best$contrast, best$p_BH, best$cliffs_delta))
cat("Spearman duration–energy by gen (BH):\n"); print(spearman_by_gen, n = Inf)
# ==============================================================================
# RQ 3.2 — Inference duration and energy consumption (REVISED)
#
# DESIGN CHANGE (Addressing Professor Feedback):
#   • Unit of analysis: REPETITION (N=900, raw data).
#   • Reason: Averaging runs caused a loss of statistical power.
#   • DV: Instantaneous power per repetition (W) = energy_j / duration_s.
#   • Factor: generation (ordered: 2, 3, 3.1, 3.2).
#
# TESTS (Non-parametric due to non-normality):
#   1) Omnibus: Kruskal–Wallis on power_w ~ generation.
#   2) Planned post-hoc (successive, BH-adjusted): Wilcoxon rank-sum.
#      - Effect size: Cliff’s delta (positive = newer gen uses MORE power).
#   3) Correlation check: Spearman ρ between duration and energy (repetition-level).
# ==============================================================================
suppressPackageStartupMessages({
library(tidyverse)  # dplyr, ggplot2, purrr, readr
library(effsize)    # For automated Cliff's delta calculation
})
# ---------- 0) Data Check & Preparation ----------
# Ensure we are using the full repetition dataset, not the averaged runs
if (!exists("repetition_level")) {
stop("Error: 'repetition_level' dataframe not found. Please load the raw repetition data first.")
}
stopifnot(all(c("generation", "energy_j", "duration_s") %in% names(repetition_level)))
suppressPackageStartupMessages({
library(tidyverse)  # dplyr, ggplot2, purrr, readr
library(effsize)    # For automated Cliff's delta calculation
})
# ---------- 0) Data Check & Preparation ----------
# Ensure we are using the full repetition dataset, not the averaged runs
if (!exists("repetition_level")) {
stop("Error: 'repetition_level' dataframe not found. Please load the raw repetition data first.")
}
# ---------- 0) Data Check & Preparation ----------
# Ensure we are using the full repetition dataset, not the averaged runs
if (!exists("repetition_level")) {
stop("Error: 'repetition_level' dataframe not found. Please load the raw repetition data first.")
}
stopifnot(all(c("generation", "energy_j", "duration_s") %in% names(repetition_level)))
# ---- Build run-level table (one row per run) ----
repetition_level <- df %>%
mutate(
generation = factor(generation, levels = c("2","3","3.1","3.2"), ordered = TRUE)
) %>%
transmute(
# Keys
run, repetition, generation, task, model_size_label, model_size_b,
# Raw metrics (Critical for RQ3.2 script)
energy_j          = energy_j,
duration_s        = duration_s,
energy_per_token  = energy_per_token,
accuracy          = accuracy,
tokens            = tokens,
# Derived
logE              = log1p(energy_j)
)
# ==============================================================================
# RQ 3.2 — Inference duration and energy consumption (REVISED)
#
# DESIGN CHANGE (Addressing Professor Feedback):
#   • Unit of analysis: REPETITION (N=900, raw data).
#   • Reason: Averaging runs caused a loss of statistical power.
#   • DV: Instantaneous power per repetition (W) = energy_j / duration_s.
#   • Factor: generation (ordered: 2, 3, 3.1, 3.2).
#
# TESTS (Non-parametric due to non-normality):
#   1) Omnibus: Kruskal–Wallis on power_w ~ generation.
#   2) Planned post-hoc (successive, BH-adjusted): Wilcoxon rank-sum.
#      - Effect size: Cliff’s delta (positive = newer gen uses MORE power).
#   3) Correlation check: Spearman ρ between duration and energy (repetition-level).
# ==============================================================================
suppressPackageStartupMessages({
library(tidyverse)  # dplyr, ggplot2, purrr, readr
library(effsize)    # For automated Cliff's delta calculation
})
# ---------- 0) Data Check & Preparation ----------
# Ensure we are using the full repetition dataset, not the averaged runs
if (!exists("repetition_level")) {
stop("Error: 'repetition_level' dataframe not found. Please load the raw repetition data first.")
}
stopifnot(all(c("generation", "energy_j", "duration_s") %in% names(repetition_level)))
dir.create("tables", showWarnings = FALSE, recursive = TRUE)
dir.create("plots",  showWarnings = FALSE, recursive = TRUE)
# Calculate Power (W) for every single repetition
rq32 <- repetition_level %>%
mutate(
# Avoid division by zero if duration is essentially zero
power_w = energy_j / pmax(duration_s, 1e-9),
generation = factor(generation, levels = c("2", "3", "3.1", "3.2"), ordered = TRUE)
) %>%
select(generation, energy_j, duration_s, power_w) %>%
drop_na(power_w, energy_j, duration_s)
cat(sprintf("Data loaded: %d repetitions across %d generations.\n", nrow(rq32), nlevels(rq32$generation)))
# ---------- 1) Descriptives (Repetition Level) ----------
cat("\n--- RQ3.2 Descriptives (Repetition Level) ---\n")
desc <- rq32 %>%
group_by(generation) %>%
summarise(
n_obs             = n(),
mean_duration_s   = mean(duration_s),
median_duration_s = median(duration_s),
sd_duration_s     = sd(duration_s),
mean_energy_J     = mean(energy_j),
median_energy_J   = median(energy_j),
sd_energy_J       = sd(energy_j),
mean_power_W      = mean(power_w),
median_power_W    = median(power_w),
sd_power_W        = sd(power_w),
.groups = "drop"
) %>% arrange(generation)
print(desc, n = Inf)
readr::write_csv(desc, "tables/RQ32_descriptives_repetition_level.csv")
# ---------- 2) Omnibus: Kruskal–Wallis on Power ----------
cat("\n--- Kruskal–Wallis: power_w ~ generation ---\n")
kw <- kruskal.test(power_w ~ generation, data = rq32)
print(kw)
H <- as.numeric(kw$statistic)
k <- nlevels(rq32$generation)
n <- nrow(rq32)
eps2 <- (H - k + 1) / (n - k) # Epsilon-squared effect size
omnibus_csv <- tibble(
term     = "generation",
H_stat   = H,
df       = k - 1,
p_value  = kw$p.value,
epsilon2 = eps2,
note     = "Kruskal–Wallis on power (repetition-level)"
)
readr::write_csv(omnibus_csv, "tables/RQ32_omnibus_kw.csv")
cat(sprintf("Epsilon-squared (omnibus): %.3f\n", eps2))
# ---------- 3) Post-hoc: Successive Wilcoxon (BH-adjusted) ----------
gens  <- levels(rq32$generation)
pairs <- tibble(g1 = gens[-length(gens)], g2 = gens[-1])
one_step <- function(g1, g2) {
sub <- rq32 %>%
filter(generation %in% c(g1, g2)) %>%
mutate(generation = droplevels(generation))
# Wilcoxon Rank Sum Test
wt <- wilcox.test(power_w ~ generation, data = sub, exact = FALSE)
# Cliff's Delta calculation
# We use the 'effsize' package or manual calc if preferred.
# Here manual to ensure direction: (Newer - Older)
x <- sub$power_w[sub$generation == g1] # Older
y <- sub$power_w[sub$generation == g2] # Newer
# Cliff's delta manual: ( #(y>x) - #(y<x) ) / (nx * ny)
# Positive delta means Newer (y) values are generally larger than Older (x)
d_est <- cliff.delta(y, x)$estimate
tibble(
contrast     = paste(g2, "-", g1),
W            = unname(wt$statistic),
p_raw        = wt$p.value,
cliffs_delta = d_est
)
}
wtab <- purrr::map2_dfr(pairs$g1, pairs$g2, one_step) %>%
mutate(
p_BH = p.adjust(p_raw, method = "BH"),
direction_note = "Cliff's delta > 0 means NEWER gen has HIGHER power"
)
cat("\n--- Successive Wilcoxon tests on power (BH-adjusted) ---\n")
print(wtab, n = Inf)
readr::write_csv(wtab, "tables/RQ32_wilcoxon_consec.csv")
# ---------- 4) Spearman Correlation: Duration vs Energy (Repetition Level) ----------
spearman_by_gen <- rq32 %>%
group_by(generation) %>%
group_modify(~{
ct <- suppressWarnings(cor.test(.x$duration_s, .x$energy_j,
method = "spearman"))
tibble(rho = unname(ct$estimate), p = ct$p.value)
}) %>%
ungroup() %>%
mutate(p_BH = p.adjust(p, method = "BH"))
cat("\n--- Spearman correlation: duration vs energy (repetition-level) ---\n")
print(spearman_by_gen, n = Inf)
readr::write_csv(spearman_by_gen, "tables/RQ32_spearman_duration_energy.csv")
# ---------- 5) Plots (Updated for High Density Data) ----------
# 5a) Box + Violin of Power (Better for large N than just jitter)
p_box <- ggplot(rq32, aes(generation, power_w, fill = generation)) +
geom_violin(alpha = 0.3, trim = FALSE, color = NA) + # Added violin for density shape
geom_boxplot(width = 0.2, outlier.alpha = 0.2, outlier.size = 0.5) +
labs(
title = "Power Distribution by Generation (Repetition Level)",
subtitle = "Analysis on N=900 repetitions",
x = "Generation",
y = "Power (W)",
fill = "Generation"
) +
theme_minimal() +
theme(legend.position = "none")
ggsave("plots/RQ32_power_distribution.png", p_box,
width = 8, height = 5, dpi = 150, bg = "white")
# 5b) Scatter: Duration vs Energy (High density adjustment)
p_scatter <- ggplot(rq32, aes(duration_s, energy_j, color = generation)) +
geom_point(alpha = 0.4, size = 1.5) + # Lower alpha for overlapping points
geom_smooth(method = "lm", se = FALSE, size = 0.8, linetype = "dashed") + # Add trend lines
labs(
title = "Inference Duration vs Energy Consumption",
subtitle = "Repetition-level correlation",
x = "Inference Duration (s)",
y = "Energy (J)",
color = "Generation"
) +
theme_minimal()
ggsave("plots/RQ32_scatter_duration_vs_energy.png", p_scatter,
width = 8, height = 6, dpi = 150, bg = "white")
cat("\nSaved plots:\n- plots/RQ32_power_distribution.png\n- plots/RQ32_scatter_duration_vs_energy.png\n")
# ---------- 6) Summary Output ----------
cat("\n=== RQ3.2 Final Summary (Repetition Level) ===\n")
cat(sprintf("Omnibus (Kruskal-Wallis): H = %.3f, p = %.4g, Eps² = %.3f\n", H, kw$p.value, eps2))
cat("Pairwise Contrasts (Cliff's Delta):\n")
print(wtab %>% select(contrast, p_BH, cliffs_delta))
# ---------- 5) Plots ----------
# 5a) Box + jitter of average power by generation
p_box <- ggplot(rq32, aes(generation, power_w, fill = generation)) +
geom_boxplot(outlier.alpha = 0.25, width = 0.65) +
geom_jitter(width = 0.08, height = 0, alpha = 0.55, size = 1) +
labs(x = "Generation", y = "Average power per run (W)", fill = "Generation") +
theme_minimal()
ggsave("plots/Statistical_Tests/RQ3.2/RQ32_box_power_by_generation.png", p_box,
width = 8, height = 5, dpi = 150, bg = "white")
# 5b) Scatter: duration vs energy, colored by generation
p_scatter <- ggplot(rq32, aes(duration_s, energy_j, color = generation)) +
geom_point(alpha = 0.8, size = 2) +
labs(x = "Inference duration (s)", y = "Energy per run (J)", color = "Generation") +
theme_minimal()
ggsave("plots/Statistical_Tests/RQ3.2/RQ32_scatter_duration_vs_energy.png", p_scatter,
width = 8, height = 5, dpi = 150, bg = "white")
# 5b) Scatter: duration vs energy, colored by generation
p_scatter <- ggplot(rq32, aes(duration_s, energy_j, color = generation)) +
geom_point(alpha = 0.8, size = 2) +
labs(x = "Inference duration (s)", y = "Energy per run (J)", color = "Generation") +
theme_minimal()
ggsave("plots/Statistical_Tests/RQ3.2/RQ32_scatter_duration_vs_energy.png", p_scatter,
width = 8, height = 5, dpi = 150, bg = "white")
